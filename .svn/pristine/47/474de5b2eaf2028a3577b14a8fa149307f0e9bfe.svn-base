package com.zplh.zplh_android_yk.adb;

import android.Manifest;
import android.annotation.SuppressLint;
import android.app.Activity;
import android.app.ActivityManager;
import android.content.ComponentName;
import android.content.ContentProviderOperation;
import android.content.ContentProviderResult;
import android.content.ContentResolver;
import android.content.ContentUris;
import android.content.ContentValues;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.database.Cursor;
import android.net.Uri;
import android.os.Build;
import android.os.Environment;
import android.provider.ContactsContract;
import android.support.annotation.RequiresApi;
import android.support.v4.app.ActivityCompat;
import android.support.v4.content.ContextCompat;
import android.telephony.TelephonyManager;
import android.util.Log;

import com.google.gson.Gson;
import com.zplh.zplh_android_yk.R;
import com.zplh.zplh_android_yk.XmlToJson.XmlToJson;
import com.zplh.zplh_android_yk.bean.MessageListBean;
import com.zplh.zplh_android_yk.bean.NodeXmlBean;
import com.zplh.zplh_android_yk.bean.XmlBean;
import com.zplh.zplh_android_yk.conf.URLS;
import com.zplh.zplh_android_yk.utils.FileUtils;
import com.zplh.zplh_android_yk.utils.LogUtils;
import com.zplh.zplh_android_yk.utils.SPUtils;
import com.zplh.zplh_android_yk.utils.ShellUtils;
import com.zplh.zplh_android_yk.utils.StringUtils;
import com.zplh.zplh_android_yk.utils.ViewCheckUtils;

import org.xutils.common.Callback;
import org.xutils.http.RequestParams;
import org.xutils.x;

import java.io.BufferedInputStream;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Random;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * Created by lichun on 2017/6/5.
 * Description:æ“ä½œå¾®ä¿¡å·¥å…·ç±»
 */

public class WxUtils {

    private List<String> commnandList;
    private List<Integer> listXY;
    private Gson gson = new Gson();


    //è¿”å›nodeèŠ‚ç‚¹æ•°æ®
    public List<String> getNodeList(String node) {
        List<String> ls = new ArrayList<String>();
        ls.clear();
        Pattern pattern = Pattern.compile("<node.*?text=\"(.*?)\".*?resource-id=\"(.*?)\" class=\"(.*?)\" package=\"(.*?)\".*?content-desc=\"(.*?)\".*?checked=\"(.*?)\".*?enabled=\"(.*?)\".*?selected=\"(.*?)\".*?bounds=\"\\[(\\d+),(\\d+)\\]\\[(\\d+),(\\d+)\\]\"");
        Matcher matcher = pattern.matcher(node);
        while (matcher.find()) {
            ls.add(matcher.group() + "/>");
        }
        return ls;
    }

    public int[] getLinkedXY(String s) {
        int[] linked = new int[4];
        int i = 0;
        for (String sss : s.replaceAll("[^0-9]", ",").split(",")) {
            if (sss.length() > 0) {
                try {
                    Integer a = Integer.parseInt(sss);
                    linked[i] = a;
                } catch (NumberFormatException e) {
                    e.printStackTrace();
                } finally {
                    i++;
                }
            }
        }
        return linked;
    }

    public XmlBean getXmlBean() {
        adbDump();
        return gson.fromJson(xml2JSON(readTxtFile()), XmlBean.class);
    }

    public NodeXmlBean getNodeXmlBean(String str) {
        return gson.fromJson(xml2JSON(str), NodeXmlBean.class);
    }

    public String getXmlData() {
        adbDump();
        return readTxtFile();
    }

    /**
     * ä»å­—ç¬¦ä¸²ä¸­æå–æ•°å­—
     *
     * @param s
     * @return
     */
    public List<Integer> getXY(String s) {
        if (listXY != null) {
            listXY.clear();
        } else {
            listXY = new ArrayList<>();
        }
        for (String sss : s.replaceAll("[^0-9]", ",").split(",")) {
            if (sss.length() > 0)
                try {
                    Integer a = Integer.parseInt(sss);
                    listXY.add(a);
                } catch (NumberFormatException e) {
                    e.printStackTrace();
                }

        }
        return listXY;
    }

    /**
     * ç‚¹åæ ‡
     *
     * @param a
     * @param b
     * @param c
     * @param d
     */
    public void adbClick(int a, int b, int c, int d) {
        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }
        commnandList.add("input tap " + (a + c) / 2 + " " + (b + d) / 2);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }
    /**
     * ç‚¹åæ ‡
     *
     * @param a
     * @param b
     */
    public void adbWxClick(int a, int b ) {
        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }
        commnandList.add("input tap " + a+ " " + b);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }


    /**
     * ç‚¹å‡»åæ ‡ï¼ˆå±å¹•é€‚é…ï¼‰
     *
     * @param context
     * @param aa
     * @param bb
     * @param cc
     * @param dd
     */
    public void adbDimensClick(Context context, int aa, int bb, int cc, int dd) {
        int a = context.getResources().getDimensionPixelSize(aa);
        int b = context.getResources().getDimensionPixelSize(bb);
        int c = context.getResources().getDimensionPixelSize(cc);
        int d = context.getResources().getDimensionPixelSize(dd);

        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }

        commnandList.add("input tap " + (a + c) / 2 + " " + (b + d) / 2);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }
// wxUtils.adb("input swipe 200 630 200 200");//å‘ä¸‹æ»‘åŠ¨

    /**
     * å‘ä¸Šæ»‘åŠ¨ï¼ˆå±å¹•é€‚é…ï¼‰
     *
     * @param context
     */
    public void adbUpSlide(Context context) {

        int a = context.getResources().getDimensionPixelSize(R.dimen.x134);

        int b = context.getResources().getDimensionPixelSize(R.dimen.y295);
        int c = context.getResources().getDimensionPixelSize(R.dimen.x134);
        int d = context.getResources().getDimensionPixelSize(R.dimen.y94);

        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }

        commnandList.add("input swipe " + a + " " + b + " " + c + " " + d);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }


    /**
     * æ‹‰ç¾¤å‘ä¸Šæ»‘åŠ¨ï¼ˆå±å¹•é€‚é…ï¼‰
     *
     * @param context
     */
    public void adbQunUpSlide(Context context) {

        int a = context.getResources().getDimensionPixelSize(R.dimen.x134);
        int b = context.getResources().getDimensionPixelSize(R.dimen.y283);
        int c = context.getResources().getDimensionPixelSize(R.dimen.x134);
        int d = context.getResources().getDimensionPixelSize(R.dimen.y94);

        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }

        commnandList.add("input swipe " + a + " " + b + " " + c + " " + d);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }

    /**
     * è·å–é¡µé¢xmlæ•°æ®
     */
    public void adbDump() {
        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }
        commnandList.add("uiautomator dump /sdcard/uidump.xml");
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }

    /**
     * adb shell input tap 279 1897
     * input tap 279 1897
     * æ‰§è¡Œadbå‘½ä»¤
     *
     * @param str
     */
    public void adb(String str) {
        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }
        commnandList.add(str);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }

    //è·³è½¬åˆ°ä¸»é¡µé¢
    public void openHome(Activity activity) {
        Intent intent1 = new Intent(Intent.ACTION_MAIN);

        intent1.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); //å¦‚æœæ˜¯æœåŠ¡é‡Œè°ƒç”¨ï¼Œå¿…é¡»åŠ å…¥new taskæ ‡è¯†

        intent1.addCategory(Intent.CATEGORY_HOME);

        activity.startActivity(intent1);
    }

    /**
     * è·³è½¬åˆ°å¾®ä¿¡
     *
     * @param activity
     */
    public void openWx(Activity activity) {
        Intent intent = new Intent(Intent.ACTION_MAIN);
        intent.addCategory(Intent.CATEGORY_LAUNCHER);
        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        ComponentName cn = new ComponentName("com.tencent.mm", "com.tencent.mm.ui.LauncherUI");
        intent.setComponent(cn);
        activity.startActivity(intent);
    }

    /**
     * è·³è½¬åˆ°æ”¯ä»˜å®
     */
    public void openAliPay() {
        com.wanj.x007_common.util.ShellUtils.myExecCommand("am start -a android.intent.action.MAIN -n com.eg.android.AlipayGphone/com.eg.android.AlipayGphone.AlipayLogin");

    }

    /**
     * xmlè½¬json
     *
     * @param xml
     * @return
     */
    public String xml2JSON(String xml) {
        try {
            XmlToJson xmlToJson = new XmlToJson.Builder(xml).build();

            String newJson = xmlToJson.toJson().toString().replaceAll("\"node\":\\[", "\"node_list\":[");
            return newJson;
        } catch (Exception e) {
            e.printStackTrace();
            return "";
        }
    }

    /**
     * è·å–æ‰‹æœºIMEIå·
     */
    @SuppressLint("MissingPermission")
    @RequiresApi(api = Build.VERSION_CODES.M)
    public static String getIMEI(Context context) {
/*        TelephonyManager telephonyManager = (TelephonyManager) context.getSystemService(context.TELEPHONY_SERVICE);
        String imei = telephonyManager.getDeviceId();*/
        String imeiList = "";
        TelephonyManager telephonyManagerlist = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
        for (int slot = 0; slot < telephonyManagerlist.getPhoneCount(); slot++) {
            if (telephonyManagerlist.getDeviceId(slot) != null) {
                if (!telephonyManagerlist.getDeviceId(slot).startsWith("A"))
                    imeiList = telephonyManagerlist.getDeviceId(slot);
                LogUtils.d("imeiList_" + telephonyManagerlist.getDeviceId(slot));
            }
        }
        if (StringUtils.isEmpty(imeiList)) {
            imeiList = telephonyManagerlist.getDeviceId();
        }
        return imeiList;
    }


    /**
     * 6.0æƒé™è·å–
     * android.permission.ACCESS_SUPERUSER
     *
     * @param context
     * @param activity
     */
    public static void getOpenWRITE(Context context, Activity activity) {
        if (ContextCompat.checkSelfPermission(context, Manifest.permission.CAMERA)  //æ‰“å¼€ç›¸æœºæƒé™
                != PackageManager.PERMISSION_GRANTED ||
                ContextCompat.checkSelfPermission(context, Manifest.permission.READ_EXTERNAL_STORAGE)   //å¯è¯»
                        != PackageManager.PERMISSION_GRANTED ||
                ContextCompat.checkSelfPermission(context, Manifest.permission.WRITE_EXTERNAL_STORAGE)  //å¯å†™
                        != PackageManager.PERMISSION_GRANTED ||
                ContextCompat.checkSelfPermission(context, Manifest.permission.READ_PHONE_STATE)  //å¯å†™
                        != PackageManager.PERMISSION_GRANTED  ||
                ContextCompat.checkSelfPermission(context, Manifest.permission.WRITE_CONTACTS)  //å¯å†™
                        != PackageManager.PERMISSION_GRANTED  ||
                ContextCompat.checkSelfPermission(context, Manifest.permission.READ_CONTACTS)  //å¯å†™
                        != PackageManager.PERMISSION_GRANTED

                ) {
            //ç”³è¯·WRITE_EXTERNAL_STORAGEæƒé™
            ActivityCompat.requestPermissions(activity, new String[]{Manifest.permission.CAMERA, Manifest.permission.READ_EXTERNAL_STORAGE
                            , Manifest.permission.WRITE_EXTERNAL_STORAGE, Manifest.permission.READ_PHONE_STATE,Manifest.permission.WRITE_CONTACTS,Manifest.permission.READ_CONTACTS},
                    1);
        }
    }


    /**
     * è¯»å–sdå¡ xmlæ•°æ®
     *
     * @param
     * @return
     */
    public String readTxtFile() {
        String path = Environment.getExternalStorageDirectory().getAbsoluteFile() + "/uidump.xml";
        ;
        StringBuilder builder = new StringBuilder();
        //æ‰“å¼€æ–‡ä»¶
        File file = new File(path);
        //å¦‚æœpathæ˜¯ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œå¯ä»¥åšä¸€ä¸ªéç›®å½•çš„åˆ¤æ–­
        if (file.isDirectory()) {
            Log.d("TestFile", "The File doesn't not exist.");
        } else {
            try {
                InputStream instream = new FileInputStream(file);
                if (instream != null) {
                    InputStreamReader inputreader = new InputStreamReader(instream);
                    BufferedReader buffreader = new BufferedReader(inputreader);
                    String line;
                    //åˆ†è¡Œè¯»å–
                    while ((line = buffreader.readLine()) != null) {
                        builder.append(line + "\n");
                    }
                    instream.close();
                }
            } catch (java.io.FileNotFoundException e) {
                Log.d("TestFile", "The File doesn't not exist.");
            } catch (IOException e) {
                Log.d("TestFile", e.getMessage());
            }
        }
        return builder.toString();
    }

    /**
     * åˆ é™¤å…¨éƒ¨è”ç³»äºº
     *
     * @return
     */
    public HashMap<String, Object> delAllContacts(ContentResolver resolver) {
        ArrayList<ContentProviderOperation> ops = new ArrayList<ContentProviderOperation>();
        ContentProviderOperation op = null;
        Uri uri = null;
        HashMap<String, Object> delResult = new HashMap<String, Object>();
        int num = 0;//åˆ é™¤å½±å“çš„è¡Œæ•°
        resolver.delete(Uri.parse(ContactsContract.RawContacts.CONTENT_URI.toString() + "?"
                        + ContactsContract.CALLER_IS_SYNCADAPTER + "=true"),
                ContactsContract.RawContacts._ID + ">0", null);
        //åˆ é™¤Dataè¡¨çš„æ•°æ®
        uri = Uri.parse(ContactsContract.Data.CONTENT_URI.toString() + "?" + ContactsContract.CALLER_IS_SYNCADAPTER + "=true");
        op = ContentProviderOperation.newDelete(uri)
                .withSelection(ContactsContract.Data.RAW_CONTACT_ID + ">0", null)
                .withYieldAllowed(true)
                .build();
        ops.add(op);
        //åˆ é™¤RawContactsè¡¨çš„æ•°æ®
        uri = Uri.parse(ContactsContract.RawContacts.CONTENT_URI.toString() + "?" + ContactsContract.CALLER_IS_SYNCADAPTER + "=true");
        op = ContentProviderOperation.newDelete(ContactsContract.RawContacts.CONTENT_URI)
                .withSelection(ContactsContract.RawContacts._ID + ">0", null)
                .withYieldAllowed(true)
                .build();
        ops.add(op);
        //åˆ é™¤Contactsè¡¨çš„æ•°æ®
        uri = Uri.parse(ContactsContract.Contacts.CONTENT_URI.toString() + "?" + ContactsContract.CALLER_IS_SYNCADAPTER + "=true");
        op = ContentProviderOperation.newDelete(uri)
                .withSelection(ContactsContract.Contacts._ID + ">0", null)
                .withYieldAllowed(true)
                .build();
        ops.add(op);
        //æ‰§è¡Œæ‰¹é‡åˆ é™¤
        try {
            ContentProviderResult[] results = resolver.applyBatch(ContactsContract.AUTHORITY, ops);
            for (ContentProviderResult result : results) {
                num += result.count;
                LogUtils.d("å½±å“çš„è¡Œæ•°" + result.count);
            }
            delResult.put("result", "1");
            delResult.put("obj", num);
        } catch (Exception e) {
            LogUtils.d("å½±å“çš„è¡Œæ•°" + e.getMessage());
            delResult.put("result", "-1");
            delResult.put("obj", "åˆ é™¤å¤±è´¥ï¼" + e.getMessage());
        }
        if (delResult.size() == 0) {
            delResult.put("result", "0");
            delResult.put("obj", "æ— æ•ˆåˆ é™¤ï¼Œè”ç³»äººä¿¡æ¯ä¸æ­£ç¡®ï¼");
        }
        return delResult;
    }

    /**
     * æ¸…é™¤æ‰€æœ‰è”ç³»äºº
     *
     * @param context
     */
    public void DeletPhone(Context context) {
        //ShowToast.show("æ­£åœ¨æ¸…ç†è”ç³»äºº", (Activity) context);
        try {
            ViewCheckUtils.check();
        } catch (Exception e) {
            e.printStackTrace();
        }
        ContentResolver cr = context.getContentResolver();
        Cursor cur = cr.query(ContactsContract.Contacts.CONTENT_URI,
                null, null, null, null);
        while (cur.moveToNext()) {
            try {
                String lookupKey = cur.getString(cur.getColumnIndex(
                        ContactsContract.Contacts.LOOKUP_KEY));
                Uri uri = Uri.withAppendedPath(ContactsContract.
                        Contacts.CONTENT_LOOKUP_URI, lookupKey);
                System.out.println("The uri is " + uri.toString());
                cr.delete(uri, null, null);
            } catch (Exception e) {
                System.out.println(e.getStackTrace());
            }
        }
        cur.close();
        // ShowToast.show("æ‰‹æœºè”ç³»äººæ¸…ç†å®Œæˆ", (Activity) context);
    }

    /**
     * è·å–æ‰‹æœºé€šè®¯å½•çš„è”ç³»äººçš„æ•°é‡
     *
     * @param context
     * @return
     */
    public int getContactCount(Context context) {
        try {
            ViewCheckUtils.check();
        } catch (Exception e) {

        }
        Cursor c = context.getContentResolver().query(ContactsContract.Contacts.CONTENT_URI, new String[]{ContactsContract.Contacts._COUNT}, null, null, null);
        try {
            c.moveToFirst();
            return c.getInt(0);
        } catch (Exception e) {
            return 0;
        } finally {
            c.close();
        }
    }

    // æ·»åŠ è”ç³»
    public void addContact(String name, String phoneNumber, Context context) {
        try {
            ViewCheckUtils.check();
        } catch (Exception e) {
            e.printStackTrace();
        }
        // åˆ›å»ºä¸€ä¸ªç©ºçš„ContentValues
        ContentValues values = new ContentValues();

        // å‘RawContacts.CONTENT_URIç©ºå€¼æ’å…¥ï¼Œ
        // å…ˆè·å–Androidç³»ç»Ÿè¿”å›çš„rawContactId
        // åé¢è¦åŸºäºæ­¤idæ’å…¥å€¼
        Uri rawContactUri = context.getContentResolver().insert(ContactsContract.RawContacts.CONTENT_URI, values);

        long rawContactId = ContentUris.parseId(rawContactUri);
        values.clear();

        values.put(ContactsContract.Data.RAW_CONTACT_ID, rawContactId);
        // å†…å®¹ç±»å‹
        values.put(ContactsContract.Data.MIMETYPE, ContactsContract.CommonDataKinds.StructuredName.CONTENT_ITEM_TYPE);
        // è”ç³»äººåå­—
        values.put(ContactsContract.CommonDataKinds.StructuredName.GIVEN_NAME, name);
        // å‘è”ç³»äººURIæ·»åŠ è”ç³»äººåå­—
        context.getContentResolver().insert(ContactsContract.Data.CONTENT_URI, values);
        values.clear();

        values.put(ContactsContract.Data.RAW_CONTACT_ID, rawContactId);
        values.put(ContactsContract.Data.MIMETYPE, ContactsContract.CommonDataKinds.Phone.CONTENT_ITEM_TYPE);
        // è”ç³»äººçš„ç”µè¯å·ç 
        values.put(ContactsContract.CommonDataKinds.Phone.NUMBER, phoneNumber);
        // ç”µè¯ç±»å‹
        values.put(ContactsContract.CommonDataKinds.Phone.TYPE, ContactsContract.CommonDataKinds.Phone.TYPE_MOBILE);
        // å‘è”ç³»äººç”µè¯å·ç URIæ·»åŠ ç”µè¯å·ç 
        context.getContentResolver().insert(ContactsContract.Data.CONTENT_URI, values);
        values.clear();

        values.put(ContactsContract.Data.RAW_CONTACT_ID, rawContactId);
        values.put(ContactsContract.Data.MIMETYPE, ContactsContract.CommonDataKinds.Email.CONTENT_ITEM_TYPE);
        // è”ç³»äººçš„Emailåœ°å€
//        values.put(ContactsContract.CommonDataKinds.Email.DATA, "zhangphil@xxx.com");
        // ç”µå­é‚®ä»¶çš„ç±»å‹
        values.put(ContactsContract.CommonDataKinds.Email.TYPE, ContactsContract.CommonDataKinds.Email.TYPE_WORK);
        // å‘è”ç³»äººEmail URIæ·»åŠ Emailæ•°æ®
        context.getContentResolver().insert(ContactsContract.Data.CONTENT_URI, values);

//        Toast.makeText(context, "è”ç³»äººæ•°æ®æ·»åŠ æˆåŠŸ", Toast.LENGTH_SHORT).show();
    }

   /*   new Thread(new Runnable() {
        @Override
        public void run() {
            String s="18671522513,18671519721,18671522931,18671595527,18671519307,18671522167,\n" +
                    "18696091451,18671512397,18671167573,18671547261";
            String[] strList=s.split(",");
            for (int a=0;a<strList.length;a++){
                new WxUtils().addContact(strList[a],strList[a],mContext);
            }
        }
    }).start();*/

    /**
     * [ä¸‹è½½APP]
     */
    public static File getFileFromServer(String path) throws Exception {
        // å¦‚æœç›¸ç­‰çš„è¯è¡¨ç¤ºå½“å‰çš„sdcardæŒ‚è½½åœ¨æ‰‹æœºä¸Šå¹¶ä¸”æ˜¯å¯ç”¨çš„
        if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
            URL url = new URL(path);
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setConnectTimeout(25000);
            // è·å–åˆ°æ–‡ä»¶çš„å¤§å°
            InputStream is = conn.getInputStream();
            File file = new File(Environment.getExternalStorageDirectory(), "wxykupdata.apk");
            FileOutputStream fos = new FileOutputStream(file);
            BufferedInputStream bis = new BufferedInputStream(is);
            byte[] buffer = new byte[1024];
            int len;
            int total = 0;
            while ((len = bis.read(buffer)) != -1) {
                fos.write(buffer, 0, len);
                total += len;
            }
            fos.close();
            bis.close();
            is.close();
            return file;
        } else {
            return null;
        }
    }

    /**
     * [ä¸‹è½½æ–‡ä»¶]
     */
    public static File getFileDown(String path, String name) throws Exception {
        // å¦‚æœç›¸ç­‰çš„è¯è¡¨ç¤ºå½“å‰çš„sdcardæŒ‚è½½åœ¨æ‰‹æœºä¸Šå¹¶ä¸”æ˜¯å¯ç”¨çš„
        if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
            URL url = new URL(path);
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setConnectTimeout(25000);
            // è·å–åˆ°æ–‡ä»¶çš„å¤§å°
            InputStream is = conn.getInputStream();
            File file = new File(Environment.getExternalStorageDirectory() + "/ykimages", name);
            FileOutputStream fos = new FileOutputStream(file);
            BufferedInputStream bis = new BufferedInputStream(is);
            byte[] buffer = new byte[1024];
            int len;
            int total = 0;
            while ((len = bis.read(buffer)) != -1) {
                fos.write(buffer, 0, len);
                total += len;
            }
            fos.close();
            bis.close();
            is.close();
            return file;
        } else {
            return null;
        }
    }

    /**
     * [ä¸‹è½½app]
     */
    public static File getFileAliPay(String path, String name) throws Exception {
        // å¦‚æœç›¸ç­‰çš„è¯è¡¨ç¤ºå½“å‰çš„sdcardæŒ‚è½½åœ¨æ‰‹æœºä¸Šå¹¶ä¸”æ˜¯å¯ç”¨çš„
        if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
            URL url = new URL(path);
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setConnectTimeout(25000);
            // è·å–åˆ°æ–‡ä»¶çš„å¤§å°
            InputStream is = conn.getInputStream();
            File file = new File(Environment.getExternalStorageDirectory(), name);
            FileOutputStream fos = new FileOutputStream(file);
            BufferedInputStream bis = new BufferedInputStream(is);
            byte[] buffer = new byte[1024];
            int len;
            int total = 0;
            while ((len = bis.read(buffer)) != -1) {
                fos.write(buffer, 0, len);
                total += len;
            }
            fos.close();
            bis.close();
            is.close();
            return file;
        } else {
            return null;
        }
    }

    /**
     * æ·»åŠ åˆ°ç›¸å†Œ
     *
     * @param result
     * @param context
     */
    public static void addimages(File result, Context context) {
        Intent intent = new Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE);
        Uri uri = Uri.fromFile(result);
        intent.setData(uri);
        context.sendBroadcast(intent);
    }


    /**
     * [è·å–åº”ç”¨ç¨‹åºç‰ˆæœ¬åç§°ä¿¡æ¯]
     *
     * @param context
     * @return å½“å‰åº”ç”¨çš„ç‰ˆæœ¬åç§°
     */
    public static String getVersionName(Context context) {
        try {
            PackageManager packageManager = context.getPackageManager();
            PackageInfo packageInfo = packageManager.getPackageInfo(context.getPackageName(), 0);
            return packageInfo.versionName;

        } catch (PackageManager.NameNotFoundException e) {
            e.printStackTrace();
        }
        return null;
    }

    /**
     * æ‰“å¼€åº”ç”¨. åº”ç”¨åœ¨å‰å°ä¸å¤„ç†,åœ¨åå°å°±ç›´æ¥åœ¨å‰å°å±•ç¤ºå½“å‰ç•Œé¢, æœªå¼€å¯åˆ™é‡æ–°å¯åŠ¨
     */
    public static void openApplicationFromBackground(Context context) {
        Intent intent;
        ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
        List<ActivityManager.RunningTaskInfo> list = am.getRunningTasks(100);
        if (!list.isEmpty() && list.get(0).topActivity.getPackageName().equals(context.getPackageName())) {
            //æ­¤æ—¶åº”ç”¨æ­£åœ¨å‰å°, ä¸ä½œå¤„ç†
            LogUtils.d("zplhåœ¨å‰å°ä¸å¤„ç†a");
            return;
        }
        for (ActivityManager.RunningTaskInfo info : list) {
            if (info.topActivity.getPackageName().equals(context.getPackageName())) {
                intent = new Intent();
                intent.setComponent(info.topActivity);
                intent.setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);
                if (!(context instanceof Activity)) {
                    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
                }
                context.startActivity(intent);
                LogUtils.d("zplhåœ¨è¿è¡Œåå°è¿è¡Œå¤„ç†a");
                return;
            }
        }
        LogUtils.d("zplhåœ¨é‡æ–°æ‰“å¼€a");
        intent = context.getPackageManager().getLaunchIntentForPackage(context.getPackageName());
        context.startActivity(intent);

    }

    //ğŸ˜„,ğŸ˜·,ğŸ˜‚,ğŸ˜,ğŸ˜²,ğŸ˜³,ğŸ˜±,ğŸ˜”,ğŸ˜‰,ğŸ˜Œ,ğŸ˜’,ğŸ‘¿,ğŸ‘»,ğŸ’,ğŸ™,ğŸ’ª,ğŸ’°,ğŸ‚
//    public String imageData="[å¾®ç¬‘],[æ’‡å˜´],[è‰²],[å‘å‘†],[å¾—æ„],[æµæ³ª],[å®³ç¾],[é—­å˜´],[ç¡],[å¤§å“­],[å°´å°¬],[å‘æ€’],[è°ƒçš®],[å‘²ç‰™],[æƒŠè®¶],[éš¾è¿‡],[é…·],[å†·æ±—],[æŠ“ç‹‚],[å],[å·ç¬‘],[æ„‰å¿«],[ç™½çœ¼],[å‚²æ…¢],[é¥¥é¥¿],[å›°],[æƒŠæ],[æµæ±—],[æ†¨ç¬‘],[æ‚ é—²],[å¥‹æ–—],[å’’éª‚],[ç–‘é—®],[å˜˜],[æ™•],[ç–¯äº†],[è¡°],[éª·é«…],[æ•²æ‰“],[å†è§],[æ“¦æ±—],[æŠ é¼»],[é¼“æŒ],[ç³—å¤§äº†],[åç¬‘],[å·¦å“¼å“¼],[å³å“¼å“¼],[å“ˆæ¬ ],[é„™è§†],[å§”å±ˆ],[å¿«å“­äº†],[é˜´é™©],[äº²äº²],[å“],[å¯æ€œ],[èœåˆ€],[è¥¿ç“œ],[å•¤é…’],[ç¯®çƒ],[ä¹’ä¹“],[å’–å•¡],[é¥­],[çŒªå¤´],[ç«ç‘°],[å‡‹è°¢],[å˜´å”‡],[çˆ±å¿ƒ],[å¿ƒç¢],[è›‹ç³•],[é—ªç”µ],[ç‚¸å¼¹],[åˆ€],[è¶³çƒ],[ç“¢è™«],[ä¾¿ä¾¿],[æœˆäº®],[å¤ªé˜³],[ç¤¼ç‰©],[æ‹¥æŠ±],[å¼º],[å¼±],[æ¡æ‰‹],[èƒœåˆ©],[æŠ±æ‹³],[å‹¾å¼•],[æ‹³å¤´],[å·®åŠ²],[NO],[OK],[çˆ±æƒ…],[é£å»],[è·³è·³],[å‘æŠ–],[æ€„ç«],[è½¬åœˆ],[ç£•å¤´],[å›å¤´],[è·³ç»³],[æŠ•é™]";
    //ç­›é€‰åçš„
    public String imageData = "[å¾®ç¬‘],[æ’‡å˜´],[è‰²],[å‘å‘†],[å¾—æ„],[æµæ³ª],[å®³ç¾],[é—­å˜´],[ç¡],[å¤§å“­],[å°´å°¬],[è°ƒçš®],[å‘²ç‰™],[æƒŠè®¶],[éš¾è¿‡],[é…·],[å†·æ±—],[å],[å·ç¬‘],[æ„‰å¿«],[ç™½çœ¼],[å‚²æ…¢],[é¥¥é¥¿],[å›°],[æƒŠæ],[æµæ±—],[æ†¨ç¬‘],[æ‚ é—²],[å¥‹æ–—],[ç–‘é—®],[å˜˜],[æ™•],[ç–¯äº†],[æ•²æ‰“],[å†è§],[æ“¦æ±—],[æŠ é¼»],[é¼“æŒ],[ç³—å¤§äº†],[åç¬‘],[å·¦å“¼å“¼],[å³å“¼å“¼],[å“ˆæ¬ ],[é„™è§†],[å§”å±ˆ],[å¿«å“­äº†],[é˜´é™©],[äº²äº²],[å“],[å¯æ€œ],[è¥¿ç“œ],[å•¤é…’],[ç¯®çƒ],[ä¹’ä¹“],[å’–å•¡],[é¥­],[çŒªå¤´],[ç«ç‘°],[å‡‹è°¢],[å˜´å”‡],[çˆ±å¿ƒ],[å¿ƒç¢],[è›‹ç³•],[é—ªç”µ],[è¶³çƒ],[ç“¢è™«],[æœˆäº®],[å¤ªé˜³],[ç¤¼ç‰©],[æ‹¥æŠ±],[å¼º],[æ¡æ‰‹],[èƒœåˆ©],[æŠ±æ‹³],[å‹¾å¼•],[æ‹³å¤´],[å·®åŠ²],[NO],[OK],[çˆ±æƒ…],[é£å»],[è·³è·³],[å‘æŠ–],[æ€„ç«],[è½¬åœˆ],[ç£•å¤´],[å›å¤´],[è·³ç»³],[æŠ•é™]";

    Random random = new Random();// å®šä¹‰éšæœºç±»

    /**
     * stringæ·»åŠ éšæœºæ·»åŠ è¡¨æƒ…
     *
     * @param data
     * @return
     */
    public String getFaceText(String data) {

//        String data="æˆ‘çˆ±å“­çš„æ—¶å€™ä¾¿å“­ï¼Œæƒ³ç¬‘çš„æ—¶å€™ä¾¿ç¬‘ï¼Œåªè¦è¿™ä¸€åˆ‡å‡ºäºè‡ªç„¶ã€‚";
        String[] strings = imageData.split(",");
        int count = 0;
        String[] texts = data.split("ï¼Œ");

        for (int a = 0; a < texts.length; a++) {
            if (count >= 4) {
                break;
            } else {

                if (random.nextInt(texts.length) == 0) {
                    int num = random.nextInt(3);
                    switch (num) {
                        case 0:
                            texts[a] = texts[a] + strings[random.nextInt(strings.length - 1)];
                            break;
                        case 1:
                            texts[a] = texts[a] + strings[random.nextInt(strings.length - 1)] + strings[random.nextInt(strings.length - 1)];
                            break;
                        case 2:
                            texts[a] = texts[a] + strings[random.nextInt(strings.length - 1)] + strings[random.nextInt(strings.length - 1)] + strings[random.nextInt(strings.length - 1)];
                            break;
                    }
                    count++;
                }
            }
        }

        StringBuffer stringBuffer = new StringBuffer("");
        for (int b = 0; b < texts.length; b++) {
            if (count == 0) {
                int num = random.nextInt(3);
                switch (num) {
                    case 0:
                        stringBuffer.append(strings[random.nextInt(strings.length - 1)]);
                        break;
                    case 1:
                        stringBuffer.append(strings[random.nextInt(strings.length - 1)]).append(strings[random.nextInt(strings.length - 1)]);
                        break;
                    case 2:
                        stringBuffer.append(strings[random.nextInt(strings.length - 1)]).append(strings[random.nextInt(strings.length - 1)]).append(strings[random.nextInt(strings.length - 1)]);
                        break;
                }
                count = 1;
            }
            if (b == 0) {
                stringBuffer.append(texts[b].toString());
            } else {
                stringBuffer.append(",").append(texts[b].toString());
            }

        }
        return stringBuffer.toString();
    }


    /**
     * åˆ¤æ–­appæ˜¯å¦å®‰è£…
     *
     * @param context
     * @param packageName
     * @return
     */
    public boolean isInstallApp(Context context, String packageName) {
        try {
            context.getPackageManager().getApplicationInfo(packageName, PackageManager.GET_UNINSTALLED_PACKAGES);
            return true;

        } catch (PackageManager.NameNotFoundException e) {
            return false;
        }
    }

    /**
     * ä¿å­˜ä»»åŠ¡
     */
    public void saveTask(Context mContext, List<MessageListBean.ContentBean.DataBean> dataBeanList) {
        String saveTaskData = gson.toJson(dataBeanList);

        SPUtils.putString(mContext, "saveTaskData", saveTaskData);
        LogUtils.d("ä¿å­˜saveTaskData:" + saveTaskData);
    }


    /**
     * å†™å…¥æ–‡ä»¶åˆ°æœ¬åœ°
     *
     * @param info
     */
    public void write(String info) {
        //å†™å…¥æ–‡ä»¶
        try {
            File file = new File(Environment.getExternalStorageDirectory(),
                    "testlog.txt");
            FileOutputStream fos = new FileOutputStream(file);
            fos.write(info.getBytes());
            fos.close();
            System.out.println("å†™å…¥æˆåŠŸï¼š");
        } catch (Exception e) {
            System.out.println("å†™å…¥å¤±è´¥ï¼š");
            e.printStackTrace();
        }
    }

    /**
     * å›¾ç‰‡ä¸‹è½½
     *
     * @param messageData
     */
    public void xDownloadFile(String messageData) {

        String path = "";
        String strMark = "";
        String fileName = "";
        String filePath = "";
        String text = "";

        if (!StringUtils.isEmpty(messageData)) {//åˆ¤æ–­è¯·æ±‚åœ°å€æ˜¯å¦ä¸ºç©º
            text = messageData;
        } else {
            LogUtils.d("xå›¾æ–‡å‘å¸ƒåœ°å€ä¸ºç©º");
            return;
        }
        path = URLS.pic_vo + text.replace("\\", "/");
        LogUtils.d("xæ–‡ä»¶url__" + path);
        strMark = text.replace("\\", "/");
        fileName = strMark.substring(strMark.lastIndexOf("/")).replace("/", "").replace(" ", "");
        LogUtils.d("xa" + fileName);
        filePath = Environment.getExternalStorageDirectory().getAbsoluteFile() + "/ykimages/" + fileName;
        LogUtils.d("xb" + filePath);
        LogUtils.d("xc" + FileUtils.createDirs(Environment.getExternalStorageDirectory().getAbsoluteFile() + "/ykimages"));

        String pathUrl = Environment.getExternalStorageDirectory() + "/ykimages/" + fileName;

        if (new File(Environment.getExternalStorageDirectory().getAbsoluteFile() + "/ykimages", fileName).exists()) {//ä¸å­˜åœ¨ï¼Œä¸‹è½½
            LogUtils.d("xå­˜åœ¨");
            return;
        } else {
            LogUtils.d("xä¸å­˜åœ¨");
        }

        RequestParams requestParams = new RequestParams(path);
        requestParams.setSaveFilePath(pathUrl);
        x.http().get(requestParams, new Callback.ProgressCallback<File>() {
            @Override
            public void onWaiting() {
            }

            @Override
            public void onStarted() {
            }

            @Override
            public void onLoading(long total, long current, boolean isDownloading) {

                LogUtils.d((int) total + "");
                LogUtils.d((int) current + "");
            }

            @Override
            public void onSuccess(File result) {
                LogUtils.d("xutilsæ–‡ä»¶ä¸‹è½½æˆåŠŸ");
            }

            @Override
            public void onError(Throwable ex, boolean isOnCallback) {
                ex.printStackTrace();
                LogUtils.d("xä¸‹è½½å¤±è´¥");
            }

            @Override
            public void onCancelled(CancelledException cex) {
            }

            @Override
            public void onFinished() {
            }
        });
    }


    /**
     * æˆªå›¾
     */
    public void screenShot() {
        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }
        int count = random.nextInt(10);
        FileUtils.createDirs(Environment.getExternalStorageDirectory().getAbsoluteFile() + "/BBB");
        String command = "/system/bin/screencap -p /sdcard/" + "BBB/" + "ScreenShot.png";
        commnandList.add(command);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }

    /**
     *  æ€å¾®ä¿¡è¿›ç¨‹
     */
    public void killWx() {
        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }
        int count = random.nextInt(10);
        FileUtils.createDirs(Environment.getExternalStorageDirectory().getAbsoluteFile() + "/BBB");
        String command = "am force-stop com.tencent.mm";
        commnandList.add(command);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);
    }

    /**
     *  Wx é€šç”¨é¡µé¢è·³è½¬
     */
    public void wxActivityJump( String str ) {
        if (commnandList != null) {
            commnandList.clear();
        } else {
            commnandList = new ArrayList<>();
        }
        int count = random.nextInt(10);
        FileUtils.createDirs(Environment.getExternalStorageDirectory().getAbsoluteFile() + "/BBB");
        String command = "  am start  "+str ;
        commnandList.add(command);
        ShellUtils.CommandResult result = ShellUtils.execCommand(commnandList, true);
        LogUtils.d(result.result + "adb" + result.successMsg);

    }



}
